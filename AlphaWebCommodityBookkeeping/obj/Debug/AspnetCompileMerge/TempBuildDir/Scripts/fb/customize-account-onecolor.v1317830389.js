(function(b){var a=function(){var S={},c,N=65,u,P='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',C={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:true,flat:false},J=function(T,V){var U=j(T);b(V).data("colorpicker").fields.eq(1).val(U.r).end().eq(2).val(U.g).end().eq(3).val(U.b).end()},v=function(T,U){b(U).data("colorpicker").fields.eq(4).val(T.h).end().eq(5).val(T.s).end().eq(6).val(T.b).end()},g=function(T,U){b(U).data("colorpicker").fields.eq(0).val(R(T)).end()},m=function(T,U){b(U).data("colorpicker").selector.css("backgroundColor","#"+R({h:T.h,s:100,b:100}));b(U).data("colorpicker").selectorIndic.css({left:parseInt(150*T.s/100,10),top:parseInt(150*(100-T.b)/100,10)})},G=function(T,U){b(U).data("colorpicker").hue.css("top",parseInt(150-150*T.h/360,10))},h=function(T,U){b(U).data("colorpicker").currentColor.css("backgroundColor","#"+R(T))},F=function(T,U){b(U).data("colorpicker").newColor.css("backgroundColor","#"+R(T))},o=function(U){var W=U.charCode||U.keyCode||-1;if((W>N&&W<=90)||W==32){return false}var V=b(this).parent().parent();if(V.data("colorpicker").livePreview===true){var T=this;setTimeout(function(){e.apply(T)},50)}},e=function(U){var V=b(this).parent().parent(),T;if(this.parentNode.className.indexOf("_hex")>0){V.data("colorpicker").color=T=n(z(this.value))}else{if(this.parentNode.className.indexOf("_hsb")>0){V.data("colorpicker").color=T=f({h:parseInt(V.data("colorpicker").fields.eq(4).val(),10),s:parseInt(V.data("colorpicker").fields.eq(5).val(),10),b:parseInt(V.data("colorpicker").fields.eq(6).val(),10)})}else{V.data("colorpicker").color=T=i(M({r:parseInt(V.data("colorpicker").fields.eq(1).val(),10),g:parseInt(V.data("colorpicker").fields.eq(2).val(),10),b:parseInt(V.data("colorpicker").fields.eq(3).val(),10)}))}}if(U){J(T,V.get(0));g(T,V.get(0));v(T,V.get(0))}m(T,V.get(0));G(T,V.get(0));F(T,V.get(0));V.data("colorpicker").onChange.apply(V,[T,R(T),j(T)])},p=function(T){var U=b(this).parent().parent();U.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},K=function(){N=this.parentNode.className.indexOf("_hex")>0?70:65;b(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus");b(this).parent().addClass("colorpicker_focus")},I=function(T){var V=b(this).parent().find("input").focus();var U={el:b(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:(this.parentNode.className.indexOf("_hsb")>0?100:255),y:T.pageY,field:V,val:parseInt(V.val(),10),preview:b(this).parent().parent().data("colorpicker").livePreview};b(document).bind("mouseup",U,t);b(document).bind("mousemove",U,L)},L=function(T){T.data.field.val(Math.max(0,Math.min(T.data.max,parseInt(T.data.val+T.pageY-T.data.y,10))));if(T.data.preview){e.apply(T.data.field.get(0),[true])}return false},t=function(T){e.apply(T.data.field.get(0),[true]);T.data.el.removeClass("colorpicker_slider").find("input").focus();b(document).unbind("mouseup",t);b(document).unbind("mousemove",L);return false},x=function(T){var U={cal:b(this).parent(),y:b(this).offset().top};U.preview=U.cal.data("colorpicker").livePreview;b(document).bind("mouseup",U,s);b(document).bind("mousemove",U,l)},l=function(T){e.apply(T.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,(T.pageY-T.data.y))))/150,10)).get(0),[T.data.preview]);return false},s=function(T){J(T.data.cal.data("colorpicker").color,T.data.cal.get(0));g(T.data.cal.data("colorpicker").color,T.data.cal.get(0));b(document).unbind("mouseup",s);b(document).unbind("mousemove",l);return false},y=function(T){var U={cal:b(this).parent(),pos:b(this).offset()};U.preview=U.cal.data("colorpicker").livePreview;b(document).bind("mouseup",U,B);b(document).bind("mousemove",U,r);b("div.colorpicker_color div",U.cal).bind("click",U,r)},r=function(T){e.apply(T.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,(T.pageY-T.data.pos.top))))/150,10)).end().eq(5).val(parseInt(100*(Math.max(0,Math.min(150,(T.pageX-T.data.pos.left))))/150,10)).get(0),[T.data.preview]);return false},B=function(T){J(T.data.cal.data("colorpicker").color,T.data.cal.get(0));g(T.data.cal.data("colorpicker").color,T.data.cal.get(0));b(document).unbind("mouseup",B);b(document).unbind("mousemove",r);return false},w=function(T){b(this).addClass("colorpicker_focus")},Q=function(T){b(this).removeClass("colorpicker_focus")},q=function(U){var V=b(this).parent();var T=V.data("colorpicker").color;V.data("colorpicker").origColor=T;h(T,V.get(0));V.data("colorpicker").onSubmit(T,R(T),j(T))},E=function(T){var X=b("#"+b(this).data("colorpickerId"));b(".colorpicker").not(X).hide();X.data("colorpicker").onBeforeShow.apply(this,[X.get(0)]);var Y=b(this).offset();var W=A();var V=Y.top+this.offsetHeight;var U=Y.left;if(V+176>W.t+W.h){V-=this.offsetHeight+176}if(U+356>W.l+W.w){U-=356}X.css({left:U+"px",top:V+"px"});if(X.data("colorpicker").onShow.apply(this,[X.get(0)])!=false){X.show()}b(document).bind("mousedown",{cal:X},O);b(document).keyup(function(Z){if(Z.keyCode==27){Z.data={cal:X};O(Z)}});return true},O=function(T){if(!H(T.data.cal.get(0),T.target,T.data.cal.get(0))){if(T.data.cal.data("colorpicker").onHide.apply(this,[T.data.cal.get(0)])!=false){T.data.cal.hide()}b(document).unbind("mousedown",O)}},H=function(V,U,T){if(V==U){return true}if(V.contains){return V.contains(U)}if(V.compareDocumentPosition){return !!(V.compareDocumentPosition(U)&16)}var W=U.parentNode;while(W&&W!=T){if(W==V){return true}W=W.parentNode}return false},A=function(){var T=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(T?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(T?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(T?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(T?document.documentElement.clientHeight:document.body.clientHeight)}},f=function(T){return{h:Math.min(360,Math.max(0,T.h)),s:Math.min(100,Math.max(0,T.s)),b:Math.min(100,Math.max(0,T.b))}},M=function(T){return{r:Math.min(255,Math.max(0,T.r)),g:Math.min(255,Math.max(0,T.g)),b:Math.min(255,Math.max(0,T.b))}},z=function(V){var T=6-V.length;if(T>0){var W=[];for(var U=0;U<T;U++){W.push("0")}W.push(V);V=W.join("")}return V},d=function(T){var T=parseInt(((T.indexOf("#")>-1)?T.substring(1):T),16);return{r:T>>16,g:(T&65280)>>8,b:(T&255)}},n=function(T){return i(d(T))},i=function(U){var T={};T.b=Math.max(Math.max(U.r,U.g),U.b);T.s=(T.b<=0)?0:Math.round(100*(T.b-Math.min(Math.min(U.r,U.g),U.b))/T.b);T.b=Math.round((T.b/255)*100);if((U.r==U.g)&&(U.g==U.b)){T.h=0}else{if(U.r>=U.g&&U.g>=U.b){T.h=60*(U.g-U.b)/(U.r-U.b)}else{if(U.g>=U.r&&U.r>=U.b){T.h=60+60*(U.g-U.r)/(U.g-U.b)}else{if(U.g>=U.b&&U.b>=U.r){T.h=120+60*(U.b-U.r)/(U.g-U.r)}else{if(U.b>=U.g&&U.g>=U.r){T.h=180+60*(U.b-U.g)/(U.b-U.r)}else{if(U.b>=U.r&&U.r>=U.g){T.h=240+60*(U.r-U.g)/(U.b-U.g)}else{if(U.r>=U.b&&U.b>=U.g){T.h=300+60*(U.r-U.b)/(U.r-U.g)}else{T.h=0}}}}}}}T.h=Math.round(T.h);return T},j=function(T){var V={};var Z=Math.round(T.h);var Y=Math.round(T.s*255/100);var U=Math.round(T.b*255/100);if(Y==0){V.r=V.g=V.b=U}else{var aa=U;var X=(255-Y)*U/255;var W=(aa-X)*(Z%60)/60;if(Z==360){Z=0}if(Z<60){V.r=aa;V.b=X;V.g=X+W}else{if(Z<120){V.g=aa;V.b=X;V.r=aa-W}else{if(Z<180){V.g=aa;V.r=X;V.b=X+W}else{if(Z<240){V.b=aa;V.r=X;V.g=aa-W}else{if(Z<300){V.b=aa;V.g=X;V.r=X+W}else{if(Z<360){V.r=aa;V.g=X;V.b=aa-W}else{V.r=0;V.g=0;V.b=0}}}}}}}return{r:Math.round(V.r),g:Math.round(V.g),b:Math.round(V.b)}},D=function(T){var U=[T.r.toString(16),T.g.toString(16),T.b.toString(16)];b.each(U,function(V,W){if(W.length==1){U[V]="0"+W}});return U.join("").toUpperCase()},R=function(T){return D(j(T))};return{init:function(T){T=b.extend({},C,T||{});if(typeof T.color=="string"){T.color=n(T.color)}else{if(T.color.r!=undefined&&T.color.g!=undefined&&T.color.b!=undefined){T.color=i(T.color)}else{if(T.color.h!=undefined&&T.color.s!=undefined&&T.color.b!=undefined){T.color=f(T.color)}else{return this}}}T.origColor=T.color;var V="collorpicker_"+parseInt(Math.random()*1000);var U=b(P).attr("id",V);U.appendTo(document.body);T.fields=U.find("input").bind("keydown",o).bind("change",e).bind("blur",p).bind("focus",K);U.find("span").bind("mousedown",I);T.selector=U.find("div.colorpicker_color").bind("mousedown",y);T.selectorIndic=T.selector.find("div div");T.hue=U.find("div.colorpicker_hue div");U.find("div.colorpicker_hue").bind("mousedown",x);T.newColor=U.find("div.colorpicker_new_color");T.currentColor=U.find("div.colorpicker_current_color");U.data("colorpicker",T);U.bind("click",function(W){W.stopPropagation();W.preventDefault()});U.find("div.colorpicker_submit").bind("mouseenter",w).bind("mouseleave",Q).bind("click",q);J(T.color,U.get(0));v(T.color,U.get(0));g(T.color,U.get(0));G(T.color,U.get(0));m(T.color,U.get(0));h(T.color,U.get(0));F(T.color,U.get(0));this.each(function(){b(this).data("colorpickerId",V);b(this).filter(":text").focus(E)});this.filter(":text").keyup(function(){b(this).ColorPickerSetColor(b(this).val())});return this},showPicker:function(){return this.each(function(){if(b(this).data("colorpickerId")){E.apply(this)}})},hidePicker:function(){return this.each(function(){if(b(this).data("colorpickerId")){b("#"+b(this).data("colorpickerId")).hide()}})},setColor:function(T){if(typeof T=="string"){T=n(T)}else{if(T.r!=undefined&&T.g!=undefined&&T.b!=undefined){T=i(T)}else{if(T.h!=undefined&&T.s!=undefined&&T.b!=undefined){T=f(T)}else{return this}}}return this.each(function(){if(b(this).data("colorpickerId")){var U=b("#"+b(this).data("colorpickerId"));U.data("colorpicker").color=T;U.data("colorpicker").origColor=T;J(T,U.get(0));v(T,U.get(0));g(T,U.get(0));G(T,U.get(0));m(T,U.get(0));h(T,U.get(0));F(T,U.get(0));U.data("colorpicker").onChange.apply(U,[T,R(T),j(T)])}})}}}();b.fn.extend({ColorPicker:a.init,ColorPickerHide:a.hide,ColorPickerShow:a.show,ColorPickerSetColor:a.setColor})})(jQuery);(function(){Fresh.Color=Class.extend({init:function(c){if(!c){throw new TypeError("color must not be null")}if(Fresh.Color.isRGB(c)){this._rgb=c}else{if(Fresh.Color.isHEX(c)){this._hex=c;this._rgb=Fresh.Color.HEXtoRGB(c)}else{if(Fresh.Color.isHSV(c)){this._hsv=c;this._rgb=Fresh.Color.HSVtoRGB(c)}else{if(Fresh.Color.isHSL(c)){this._hsl=c;this._rgb=Fresh.Color.HSLtoRGB(c)}else{throw new TypeError("Color not detected")}}}}},rgb:function(){return{r:this._rgb.r,g:this._rgb.g,b:this._rgb.b}},hex:function(){if(!this._hex){this._hex=Fresh.Color.RGBtoHEX(this._rgb)}return this._hex},hsb:function(){if(!this._hsv){this._hsv=Fresh.Color.RGBtoHSV(this._rgb)}return{h:this._hsv.h,s:this._hsv.s,v:this._hsv.v}},hsl:function(){if(!this._hsl){this._hsl=Fresh.Color.RGBtoHSL(this._rgb)}return{h:this._hsl.h,s:this._hsl.s,l:this._hsl.l}},brightness:function(){return((this._rgb.r*299)+(this._rgb.g*587)+(this._rgb.b*114))/1000},brightnessDiff:function(d){var e=this.brightness();var c=d.brightness();if(e>c){return e-c}return c-e},contrast:function(c,d){c=c||"ffffff";d=d||"000000";return(a(this.hex())>a("ffffff")/2)?d:c},lighten:function(d){d/=100;var c=this.hsl();c.l+=(100-c.l)*d;c.l=Math.min(100,Math.max(0,c.l));return new Fresh.Color(c)},darken:function(d){d/=100;var c=this.hsl();c.l-=c.l*d;c.l=Math.min(100,Math.max(0,c.l));return new Fresh.Color(c)}});Fresh.Color.format=function(c){if(Fresh.Color.isRGB(c)){return{r:parseInt(c.r.toFixed(0),10),g:parseInt(c.g.toFixed(0),10),b:parseInt(c.b.toFixed(0),10)}}return c};var a=function(c){return parseInt(c,16)},b=function(d){var c=parseInt(d,10).toString(16);return(c.length===2?c:0+c)};Fresh.Color.isHEX=function(c){return(typeof(c)==="string"&&c.search)&&(c.search(/^#?[a-fA-F\d]{6}$/)===0||c.search(/^#?[a-fA-F\d]{3}$/)===0)};Fresh.Color.isRGB=function(c){if(!c||typeof(c)!=="object"||!c.hasOwnProperty("r")||c.r<0||c.r>255||!c.hasOwnProperty("g")||c.g<0||c.g>255||!c.hasOwnProperty("b")||c.b<0||c.b>255){return false}return true};Fresh.Color.isHSV=function(c){if(!c||typeof(c)!=="object"||!c.hasOwnProperty("h")||c.h<0||c.h>360||!c.hasOwnProperty("s")||c.s<0||c.s>100||!c.hasOwnProperty("v")||c.v<0||c.v>100){return false}return true};Fresh.Color.isHSL=function(c){if(!c||typeof(c)!=="object"||!c.hasOwnProperty("h")||c.h<0||c.h>360||!c.hasOwnProperty("s")||c.s<0||c.s>100||!c.hasOwnProperty("l")||c.l<0||c.l>100){return false}return true};Fresh.Color.HEXtoRGB=function(c){if(!Fresh.Color.isHEX(c)){throw new TypeError("Invalid param:"+c)}c=c.replace("#","");if(c.length==3){return{r:a(c[0]+c[0]),g:a(c[1]+c[1]),b:a(c[2]+c[2])}}else{if(c.length==6){return{r:a(c[0]+c[1]),g:a(c[2]+c[3]),b:a(c[4]+c[5])}}else{throw new Error("Bad hex code")}}};Fresh.Color.RGBtoHEX=function(c){if(!Fresh.Color.isRGB(c)){throw new TypeError("Invalid param")}return["#",b(c.r.toFixed(0)),b(c.g.toFixed(0)),b(c.b.toFixed(0))].join("")};Fresh.Color.RGBtoHSV=function(d){var c={};c.b=Math.max(Math.max(d.r,d.g),d.b);c.s=(c.b<=0)?0:Math.round(100*(c.b-Math.min(Math.min(d.r,d.g),d.b))/c.b);c.b=Math.round((c.b/255)*100);if((d.r==d.g)&&(d.g==d.b)){c.h=0}else{if(d.r>=d.g&&d.g>=d.b){c.h=60*(d.g-d.b)/(d.r-d.b)}else{if(d.g>=d.r&&d.r>=d.b){c.h=60+60*(d.g-d.r)/(d.g-d.b)}else{if(d.g>=d.b&&d.b>=d.r){c.h=120+60*(d.b-d.r)/(d.g-d.r)}else{if(d.b>=d.g&&d.g>=d.r){c.h=180+60*(d.b-d.g)/(d.b-d.r)}else{if(d.b>=d.r&&d.r>=d.g){c.h=240+60*(d.r-d.g)/(d.b-d.g)}else{if(d.r>=d.b&&d.b>=d.g){c.h=300+60*(d.r-d.b)/(d.r-d.g)}else{c.h=0}}}}}}}c.h=Math.round(c.h);c.v=c.b;return c};Fresh.Color.HSVtoRGB=function(e){var d={};var j=Math.round(e.h);var i=Math.round(e.s*255/100);var c=Math.round(e.v*255/100);if(i==0){d.r=d.g=d.b=c}else{var l=c;var g=(255-i)*c/255;var f=(l-g)*(j%60)/60;if(j==360){j=0}if(j<60){d.r=l;d.b=g;d.g=g+f}else{if(j<120){d.g=l;d.b=g;d.r=l-f}else{if(j<180){d.g=l;d.r=g;d.b=g+f}else{if(j<240){d.b=l;d.r=g;d.g=l-f}else{if(j<300){d.b=l;d.g=g;d.r=g+f}else{if(j<360){d.r=l;d.g=g;d.b=l-f}else{d.r=0;d.g=0;d.b=0}}}}}}}return{r:Math.round(d.r),g:Math.round(d.g),b:Math.round(d.b)}};Fresh.Color.RGBtoHSL=function(j){if(!Fresh.Color.isRGB(j)){throw new TypeError("Invalid param")}var c=j.r/255,i=j.g/255,m=j.b/255;var e=Math.min(c,Math.min(i,m));var n=Math.max(c,Math.max(i,m));var f=0,o=0,d=(n+e)/2;if(e!=n){if(d<0.5){o=(n-e)/(n+e)}else{o=(n-e)/(2-n-e)}if(c==n){f=(i-m)/(n-e)}else{if(i==n){f=2+(m-c)/(n-e)}else{if(m==n){f=4+(c-i)/(n-e)}}}f*=60;if(f<0){f+=360}}return{h:parseInt(f.toFixed(0),10),s:parseInt((o*100).toFixed(0),10),l:parseInt((d*100).toFixed(0),10)}};Fresh.Color.HSLtoRGB=function(m){if(!Fresh.Color.isHSL(m)){throw new TypeError("Invalid param")}var i=m.h,n=m.s/100,f=m.l/100;if(n===0){f*=255;return{r:f,g:f,b:f}}else{var d;if(f<0.5){d=f*(1+n)}else{d=f+n-(f*n)}i/=360;var e=2*f-d,c={r:i+1/3,g:i,b:i-1/3};var g={r:1,g:1,b:1};for(var j in g){c[j]=(c[j]<0?c[j]+1:(c[j]>1?c[j]-1:c[j]));if(6*c[j]<1){g[j]=e+(d-e)*6*c[j]}else{if(2*c[j]<1){g[j]=d}else{if(3*c[j]<2){g[j]=e+(d-e)*((2/3)-c[j])*6}else{g[j]=e}}}g[j]=parseInt((g[j]*255).toFixed(0),10)}return g}}})();Fresh.ColorChooser=Class.extend({defaults:{input:"",preview:null,callback:null,wellTemplate:'<div class="color_selector_box"></div>'},updateElements:null,init:function(a){this.updateElements=[];this.options=jQuery.extend({},this.defaults,a||{});this.input=$(this.options.input);this.preview=this.options.preview;this.callback=this.options.callback;this.buildElements();this.bindEvents();if(this.input.val()!==""){this.update(this.input.val())}},buildElements:function(){this.well=$(this.options.wellTemplate);this.input.after(this.well).css({height:"1px",width:"1px",border:"none",padding:0,margin:0,"float":"left"})},bindEvents:function(){var a=this;this.well.bind("click",function(b){a.input.trigger("focus")});this.input.ColorPicker({color:this.input.val(),onChange:function(b,d,c){d="#"+d;a.update(d);a.input.val(d);$(document).trigger("change.colorchooser",[b,d,c])}})},update:function(d){var e,c,b,a;if(!this.preview){return}this.well.css("backgroundColor",d);for(b=0,a=this.preview.length;b<a;b++){e=this.preview[b];if(this.updateElements[b]===undefined){this.updateElements[b]=$(e.element)}c=this.updateElements[b];jQuery.each(e.props,function(f,g){c.css(g,d)})}if(this.callback){this.callback.call(this,d)}},setColor:function(a){this.input.ColorPickerSetColor(a)}});Fresh.ColorCollection=Class.extend({defaults:{url:undefined,error:undefined,success:undefined},init:function(a){this._pickers=a.pickers||[];delete a.pickers;this.options=jQuery.extend({},this.defaults,a||{})},loadPreset:function(b){for(var c=0,a=b.length;c<a;c++){this._pickers[c].setColor(b[c])}},validate:function(){var c,b,a,d;c=new Fresh.Color("ffffff");b=new Fresh.Color(this._pickers[0].input.val());a=new Fresh.Color(this._pickers[1].input.val());d=new Fresh.Color(this._pickers[2].input.val());if(d.hex()==b.hex()){alert("Sorry, you cannot use the same color for Area 1 as Area 3 because elements of your interface will become unreadable. Please choose a different color.");return false}if(d.brightnessDiff(b)<30){alert("The contrast between Area 1 and Area 3 is too low. Please pick colors with more contrast.");return false}return true},save:function(){return $.ajax({url:this.options.url,dataType:"json",type:"POST",data:this._pickers[0].input.parents("form").serialize()})}});(function(b){var a=0;b.ajaxTransport("iframe",function(c,g,f){if(c.type==="POST"||c.type==="GET"){var e,d;return{send:function(i,h){e=b('<form style="display:none;"></form>');d=b('<iframe src="javascript:false;" name="iframe-transport-'+(a+=1)+'"></iframe>').bind("load",function(){var j;d.unbind("load").bind("load",function(){var l;try{l=d.contents();if(!l.length||!l[0].firstChild){throw new Error()}}catch(m){l=undefined}h(200,"success",{iframe:l});b('<iframe src="javascript:false;"></iframe>').appendTo(e);e.remove()});e.prop("target",d.prop("name")).prop("action",c.url).prop("method",c.type);if(c.formData){b.each(c.formData,function(l,m){b('<input type="hidden"/>').prop("name",m.name).val(m.value).appendTo(e)})}if(c.fileInput&&c.fileInput.length&&c.type==="POST"){j=c.fileInput.clone();c.fileInput.after(function(l){return j[l]});if(c.paramName){c.fileInput.each(function(){b(this).prop("name",c.paramName)})}e.append(c.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")}e.submit();if(j&&j.length){c.fileInput.each(function(m,l){var n=b(j[m]);b(l).prop("name",n.prop("name"));n.replaceWith(l)})}});e.append(d).appendTo("body")},abort:function(){if(d){d.unbind("load").prop("src","javascript".concat(":false;"))}if(e){e.remove()}}}}});b.ajaxSetup({converters:{"iframe text":function(c){return c.text()},"iframe json":function(c){return b.parseJSON(c.text())},"iframe html":function(c){return c.find("body").html()},"iframe script":function(c){return b.globalEval(c.text())}}})}(jQuery));
/*!
 * jQuery UI 1.8.15
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
(function(a,d){a.ui=a.ui||{};if(a.ui.version){return}a.extend(a.ui,{version:"1.8.15",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(e,f){return typeof e==="number"?this.each(function(){var g=this;setTimeout(function(){a(g).focus();if(f){f.call(g)}},e)}):this._focus.apply(this,arguments)},scrollParent:function(){var e;if((a.browser.msie&&(/(static|relative)/).test(this.css("position")))||(/absolute/).test(this.css("position"))){e=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test(a.curCSS(this,"position",1))&&(/(auto|scroll)/).test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0)}else{e=this.parents().filter(function(){return(/(auto|scroll)/).test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0)}return(/fixed/).test(this.css("position"))||!e.length?a(document):e},zIndex:function(h){if(h!==d){return this.css("zIndex",h)}if(this.length){var f=a(this[0]),e,g;while(f.length&&f[0]!==document){e=f.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){g=parseInt(f.css("zIndex"),10);if(!isNaN(g)&&g!==0){return g}}f=f.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});a.each(["Width","Height"],function(g,e){var f=e==="Width"?["Left","Right"]:["Top","Bottom"],h=e.toLowerCase(),l={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};function j(n,m,i,o){a.each(f,function(){m-=parseFloat(a.curCSS(n,"padding"+this,true))||0;if(i){m-=parseFloat(a.curCSS(n,"border"+this+"Width",true))||0}if(o){m-=parseFloat(a.curCSS(n,"margin"+this,true))||0}});return m}a.fn["inner"+e]=function(i){if(i===d){return l["inner"+e].call(this)}return this.each(function(){a(this).css(h,j(this,i)+"px")})};a.fn["outer"+e]=function(i,m){if(typeof i!=="number"){return l["outer"+e].call(this,i)}return this.each(function(){a(this).css(h,j(this,i,true,m)+"px")})}});function c(g,e){var j=g.nodeName.toLowerCase();if("area"===j){var i=g.parentNode,h=i.name,f;if(!g.href||!h||i.nodeName.toLowerCase()!=="map"){return false}f=a("img[usemap=#"+h+"]")[0];return !!f&&b(f)}return(/input|select|textarea|button|object/.test(j)?!g.disabled:"a"==j?g.href||e:e)&&b(g)}function b(e){return !a(e).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}a.extend(a.expr[":"],{data:function(g,f,e){return !!a.data(g,e[3])},focusable:function(e){return c(e,!isNaN(a.attr(e,"tabindex")))},tabbable:function(g){var e=a.attr(g,"tabindex"),f=isNaN(e);return(f||e>=0)&&c(g,!f)}});a(function(){var e=document.body,f=e.appendChild(f=document.createElement("div"));a.extend(f.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});a.support.minHeight=f.offsetHeight===100;a.support.selectstart="onselectstart" in f;e.removeChild(f).style.display="none"});a.extend(a.ui,{plugin:{add:function(f,g,j){var h=a.ui[f].prototype;for(var e in j){h.plugins[e]=h.plugins[e]||[];h.plugins[e].push([g,j[e]])}},call:function(e,g,f){var j=e.plugins[g];if(!j||!e.element[0].parentNode){return}for(var h=0;h<j.length;h++){if(e.options[j[h][0]]){j[h][1].apply(e.element,f)}}}},contains:function(f,e){return document.compareDocumentPosition?f.compareDocumentPosition(e)&16:f!==e&&f.contains(e)},hasScroll:function(h,f){if(a(h).css("overflow")==="hidden"){return false}var e=(f&&f==="left")?"scrollLeft":"scrollTop",g=false;if(h[e]>0){return true}h[e]=1;g=(h[e]>0);h[e]=0;return g},isOverAxis:function(f,e,g){return(f>e)&&(f<(e+g))},isOver:function(j,f,i,h,e,g){return a.ui.isOverAxis(j,i,e)&&a.ui.isOverAxis(f,h,g)}})})(jQuery);
/*!
 * jQuery UI Widget 1.8.15
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
(function(b,d){if(b.cleanData){var c=b.cleanData;b.cleanData=function(e){for(var f=0,g;(g=e[f])!=null;f++){b(g).triggerHandler("remove")}c(e)}}else{var a=b.fn.remove;b.fn.remove=function(e,f){return this.each(function(){if(!f){if(!e||b.filter(e,[this]).length){b("*",this).add([this]).each(function(){b(this).triggerHandler("remove")})}}return a.call(b(this),e,f)})}}b.widget=function(f,h,e){var g=f.split(".")[0],j;f=f.split(".")[1];j=g+"-"+f;if(!e){e=h;h=b.Widget}b.expr[":"][j]=function(l){return !!b.data(l,f)};b[g]=b[g]||{};b[g][f]=function(l,m){if(arguments.length){this._createWidget(l,m)}};var i=new h();i.options=b.extend(true,{},i.options);b[g][f].prototype=b.extend(true,i,{namespace:g,widgetName:f,widgetEventPrefix:b[g][f].prototype.widgetEventPrefix||f,widgetBaseClass:j},e);b.widget.bridge(f,b[g][f])};b.widget.bridge=function(f,e){b.fn[f]=function(i){var g=typeof i==="string",h=Array.prototype.slice.call(arguments,1),j=this;i=!g&&h.length?b.extend.apply(null,[true,i].concat(h)):i;if(g&&i.charAt(0)==="_"){return j}if(g){this.each(function(){var l=b.data(this,f),m=l&&b.isFunction(l[i])?l[i].apply(l,h):l;if(m!==l&&m!==d){j=m;return false}})}else{this.each(function(){var l=b.data(this,f);if(l){l.option(i||{})._init()}else{b.data(this,f,new e(i,this))}})}return j}};b.Widget=function(e,f){if(arguments.length){this._createWidget(e,f)}};b.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(f,g){b.data(g,this.widgetName,this);this.element=b(g);this.options=b.extend(true,{},this.options,this._getCreateOptions(),f);var e=this;this.element.bind("remove."+this.widgetName,function(){e.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return b.metadata&&b.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(f,g){var e=f;if(arguments.length===0){return b.extend({},this.options)}if(typeof f==="string"){if(g===d){return this.options[f]}e={};e[f]=g}this._setOptions(e);return this},_setOptions:function(f){var e=this;b.each(f,function(g,h){e._setOption(g,h)});return this},_setOption:function(e,f){this.options[e]=f;if(e==="disabled"){this.widget()[f?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",f)}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(f,g,h){var l=this.options[f];g=b.Event(g);g.type=(f===this.widgetEventPrefix?f:this.widgetEventPrefix+f).toLowerCase();h=h||{};if(g.originalEvent){for(var e=b.event.props.length,j;e;){j=b.event.props[--e];g[j]=g.originalEvent[j]}}this.element.trigger(g,h);return !(b.isFunction(l)&&l.call(this.element[0],g,h)===false||g.isDefaultPrevented())}}})(jQuery);(function(a){a.widget("blueimp.fileupload",{options:{namespace:undefined,dropZone:a(document),fileInput:undefined,replaceFileInput:true,paramName:undefined,singleFileUploads:true,sequentialUploads:false,limitConcurrentUploads:undefined,forceIframeTransport:false,multipart:true,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:true,formData:function(b){return b.serializeArray()},add:function(c,b){b.submit()},processData:false,contentType:false,cache:false},_refreshOptionsList:["namespace","dropZone","fileInput"],_isXHRUpload:function(b){var c="undefined";return !b.forceIframeTransport&&typeof XMLHttpRequestUpload!==c&&typeof File!==c&&(!b.multipart||typeof FormData!==c)},_getFormData:function(b){var c;if(typeof b.formData==="function"){return b.formData(b.form)}else{if(a.isArray(b.formData)){return b.formData}else{if(b.formData){c=[];a.each(b.formData,function(d,e){c.push({name:d,value:e})});return c}}}return[]},_getTotal:function(c){var b=0;a.each(c,function(d,e){b+=e.size||1});return b},_onProgress:function(f,d){if(f.lengthComputable){var c=d.total||this._getTotal(d.files),b=parseInt(f.loaded/f.total*(d.chunkSize||c),10)+(d.uploadedBytes||0);this._loaded+=b-(d.loaded||d.uploadedBytes||0);d.lengthComputable=true;d.loaded=b;d.total=c;this._trigger("progress",f,d);this._trigger("progressall",f,{lengthComputable:true,loaded:this._loaded,total:this._total})}},_initProgressListener:function(b){var c=this,d=b.xhr?b.xhr():a.ajaxSettings.xhr();if(d.upload&&d.upload.addEventListener){d.upload.addEventListener("progress",function(f){c._onProgress(f,b)},false);b.xhr=function(){return d}}},_initXHRData:function(b){var d,c=b.files[0];if(!b.multipart||b.blob){b.headers=a.extend(b.headers,{"X-File-Name":c.name,"X-File-Type":c.type,"X-File-Size":c.size});if(!b.blob){b.contentType=c.type;b.data=c}else{if(!b.multipart){b.contentType="application/octet-stream";b.data=b.blob}}}if(b.multipart&&typeof FormData!=="undefined"){if(b.formData instanceof FormData){d=b.formData}else{d=new FormData();a.each(this._getFormData(b),function(e,f){d.append(f.name,f.value)})}if(b.blob){d.append(b.paramName,b.blob)}else{a.each(b.files,function(e,f){if(f instanceof Blob){d.append(b.paramName,f)}})}b.data=d}b.blob=null},_initIframeSettings:function(b){b.dataType="iframe "+(b.dataType||"");b.formData=this._getFormData(b)},_initDataSettings:function(b){if(this._isXHRUpload(b)){if(!this._chunkedUpload(b,true)){if(!b.data){this._initXHRData(b)}this._initProgressListener(b)}}else{this._initIframeSettings(b)}},_initFormSettings:function(b){if(!b.form||!b.form.length){b.form=a(b.fileInput.prop("form"))}if(!b.paramName){b.paramName=b.fileInput.prop("name")||"files[]"}if(!b.url){b.url=b.form.prop("action")||location.href}b.type=(b.type||b.form.prop("method")||"").toUpperCase();if(b.type!=="POST"&&b.type!=="PUT"){b.type="POST"}},_getAJAXSettings:function(c){var b=a.extend({},this.options,c);this._initFormSettings(b);this._initDataSettings(b);return b},_enhancePromise:function(b){b.success=b.done;b.error=b.fail;b.complete=b.always;return b},_getXHRPromise:function(e,d,c){var b=a.Deferred(),f=b.promise();d=d||this.options.context||f;if(e===true){b.resolveWith(d,c)}else{if(e===false){b.rejectWith(d,c)}}f.abort=b.promise;return this._enhancePromise(f)},_chunkedUpload:function(o,i){var h=this,f=o.files[0],g=f.size,b=o.uploadedBytes=o.uploadedBytes||0,e=o.maxChunkSize||g,l=f.webkitSlice||f.mozSlice||f.slice,m,c,j,d;if(!(this._isXHRUpload(o)&&l&&(b||e<g))||o.data){return false}if(i){return true}if(b>=g){f.error="uploadedBytes";return this._getXHRPromise(false)}c=Math.ceil((g-b)/e);m=function(n){if(!n){return h._getXHRPromise(true)}return m(n-=1).pipe(function(){var p=a.extend({},o);p.blob=l.call(f,b+n*e,b+(n+1)*e);p.chunkSize=p.blob.size;h._initXHRData(p);h._initProgressListener(p);j=(a.ajax(p)||h._getXHRPromise(false,p.context)).done(function(){if(!p.loaded){h._onProgress(a.Event("progress",{lengthComputable:true,loaded:p.chunkSize,total:p.chunkSize}),p)}o.uploadedBytes=p.uploadedBytes+=p.chunkSize});return j})};d=m(c);d.abort=function(){return j.abort()};return this._enhancePromise(d)},_beforeSend:function(c,b){if(this._active===0){this._trigger("start")}this._active+=1;this._loaded+=b.uploadedBytes||0;this._total+=this._getTotal(b.files)},_onDone:function(b,e,d,c){if(!this._isXHRUpload(c)){this._onProgress(a.Event("progress",{lengthComputable:true,loaded:1,total:1}),c)}c.result=b;c.textStatus=e;c.jqXHR=d;this._trigger("done",null,c)},_onFail:function(c,e,d,b){b.jqXHR=c;b.textStatus=e;b.errorThrown=d;this._trigger("fail",null,b);if(b.recalculateProgress){this._loaded-=b.loaded||b.uploadedBytes||0;this._total-=b.total||this._getTotal(b.files)}},_onAlways:function(b,f,d,e,c){this._active-=1;c.result=b;c.textStatus=f;c.jqXHR=d;c.errorThrown=e;this._trigger("always",null,c);if(this._active===0){this._trigger("stop");this._loaded=this._total=0}},_onSend:function(i,g){var f=this,d,j,c,b=f._getAJAXSettings(g),h=function(l,e){f._sending+=1;d=d||((l!==false&&f._trigger("send",i,b)!==false&&(f._chunkedUpload(b)||a.ajax(b)))||f._getXHRPromise(false,b.context,e)).done(function(m,o,n){f._onDone(m,o,n,b)}).fail(function(m,o,n){f._onFail(m,o,n,b)}).always(function(n,m,p){f._sending-=1;if(p&&p.done){f._onAlways(n,m,p,undefined,b)}else{f._onAlways(undefined,m,n,p,b)}if(b.limitConcurrentUploads&&b.limitConcurrentUploads>f._sending){var o=f._slots.shift();while(o){if(!o.isRejected()){o.resolve();break}o=f._slots.shift()}}});return d};this._beforeSend(i,b);if(this.options.sequentialUploads||(this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)){if(this.options.limitConcurrentUploads>1){j=a.Deferred();this._slots.push(j);c=j.pipe(h)}else{c=(this._sequence=this._sequence.pipe(h,h))}c.abort=function(){var e=[undefined,"abort","abort"];if(!d){if(j){j.rejectWith(e)}return h(false,e)}return d.abort()};return this._enhancePromise(c)}return h()},_onAdd:function(g,f){var d=this,b=true,c=a.extend({},this.options,f);if(c.singleFileUploads&&this._isXHRUpload(c)){a.each(f.files,function(e,h){var i=a.extend({},f,{files:[h]});i.submit=function(){return d._onSend(g,i)};return(b=d._trigger("add",g,i))});return b}else{if(f.files.length){f=a.extend({},f);f.submit=function(){return d._onSend(g,f)};return this._trigger("add",g,f)}}},_normalizeFile:function(b,c){if(c.name===undefined&&c.size===undefined){c.name=c.fileName;c.size=c.fileSize}},_replaceFileInput:function(b){var c=b.clone(true);a("<form></form>").append(c)[0].reset();b.after(c).detach();this.options.fileInput=this.options.fileInput.map(function(d,e){if(e===b[0]){return c[0]}return e})},_onChange:function(d){var b=d.data.fileupload,c={files:a.each(a.makeArray(d.target.files),b._normalizeFile),fileInput:a(d.target),form:a(d.target.form)};if(!c.files.length){c.files=[{name:d.target.value.replace(/^.*\\/,"")}]}if(c.form.length){c.fileInput.data("blueimp.fileupload.form",c.form)}else{c.form=c.fileInput.data("blueimp.fileupload.form")}if(b.options.replaceFileInput){b._replaceFileInput(c.fileInput)}if(b._trigger("change",d,c)===false||b._onAdd(d,c)===false){return false}},_onDrop:function(f){var b=f.data.fileupload,d=f.dataTransfer=f.originalEvent.dataTransfer,c={files:a.each(a.makeArray(d&&d.files),b._normalizeFile)};if(b._trigger("drop",f,c)===false||b._onAdd(f,c)===false){return false}f.preventDefault()},_onDragOver:function(d){var b=d.data.fileupload,c=d.dataTransfer=d.originalEvent.dataTransfer;if(b._trigger("dragover",d)===false){return false}if(c){c.dropEffect=c.effectAllowed="copy"}d.preventDefault()},_initEventHandlers:function(){var b=this.options.namespace||this.name;this.options.dropZone.bind("dragover."+b,{fileupload:this},this._onDragOver).bind("drop."+b,{fileupload:this},this._onDrop);this.options.fileInput.bind("change."+b,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var b=this.options.namespace||this.name;this.options.dropZone.unbind("dragover."+b,this._onDragOver).unbind("drop."+b,this._onDrop);this.options.fileInput.unbind("change."+b,this._onChange)},_beforeSetOption:function(b,c){this._destroyEventHandlers()},_afterSetOption:function(c,d){var b=this.options;if(!b.fileInput){b.fileInput=a()}if(!b.dropZone){b.dropZone=a()}this._initEventHandlers()},_setOption:function(b,d){var c=a.inArray(b,this._refreshOptionsList)!==-1;if(c){this._beforeSetOption(b,d)}a.Widget.prototype._setOption.call(this,b,d);if(c){this._afterSetOption(b,d)}},_create:function(){var b=this.options;if(b.fileInput===undefined){b.fileInput=this.element.is("input:file")?this.element:this.element.find("input:file")}else{if(!b.fileInput){b.fileInput=a()}}if(!b.dropZone){b.dropZone=a()}this._slots=[];this._sequence=this._getXHRPromise(true);this._sending=this._active=this._loaded=this._total=0;this._initEventHandlers()},destroy:function(){this._destroyEventHandlers();a.Widget.prototype.destroy.call(this)},enable:function(){a.Widget.prototype.enable.call(this);this._initEventHandlers()},disable:function(){this._destroyEventHandlers();a.Widget.prototype.disable.call(this)},add:function(b){if(!b||this.options.disabled){return}b.files=a.each(a.makeArray(b.files),this._normalizeFile);this._onAdd(null,b)},send:function(b){if(b&&!this.options.disabled){b.files=a.each(a.makeArray(b.files),this._normalizeFile);if(b.files.length){return this._onSend(null,b)}}return this._getXHRPromise(false,b&&b.context)}})}(jQuery));Fresh.Uploader=Class.extend({defaults:{dragenter:null,dragleave:null,drop:null,send:null,start:null,click:null,progress:null,done:null,always:null,fail:null,change:null,form:null,input:null,dropZoneTemplate:'<div class="drop-zone"><span class="link_blue">Browse</span> or<br /> drop your image here.</div>'},input:null,form:null,progress:null,hasDragDrop:true,hasProgress:true,hasFile:true,init:function(a){this.options=jQuery.extend({},this.defaults,a||{});this.input=$(this.options.input);this.form=$(this.options.form);this._detectFeatures();this.createElements();this.bindEvents()},isEventSupported:function(b,c){var a;c="on"+c;a=(c in b);if(!a){if(b.setAttribute&&b.removeAttribute){b.setAttribute(c,"");if(typeof b[c]==="function"){a=true}b[c]=undefined;b.removeAttribute(c)}}return a},_detectFeatures:function(){this.hasDragDrop=this.isEventSupported(this.input[0],"dragstart");this.hasProgress=(window.XMLHttpRequestUpload!==undefined&&window.FormData!==undefined);this.hasFile=(window.File&&window.FileList&&window.FileReader)},createElements:function(){this.dropZone=$(this.options.dropZoneTemplate);this.progress=$('<div class="upload-progress"></div>');if(this.hasDragDrop&&this.hasProgress){this.input.before(this.dropZone);this.dropZone.append(this.progress);this.input.css("visibility","hidden");this.form.addClass("drag-drop")}else{this.dropZone.hide();this.progress.hide()}},bindEvents:function(){var f=this,d,c,a,b;this.form.fileupload({type:"POST",dataType:this.options.dataType,dropZone:this.dropZone,fileInput:this.input,url:this.options.url});d=["dragenter","dragleave","drop","click"];for(c=0,a=d.length;c<a;c++){var e=d[c];if(typeof(this.options[e])==="function"){this.dropZone.bind(e,this.options[e])}}this.dropZone.bind("click",function(g){$(this).next().trigger("click")});d={progress:"fileuploadprogress",done:"fileuploaddone",fail:"fileuploadfail",always:"fileuploadalways",start:"fileuploadstart",send:"fileuploadsend",change:"fileuploadchange"};for(b in d){if(this.options[b]&&d.hasOwnProperty(b)){this.form.bind(d[b],jQuery.proxy(this.options[b],this))}}}});Fresh.ColorCalculator=Class.extend({defaults:{numColors:3,blocksize:3,roundingFactor:5},pixel:false,canvas:false,hasCanvas:false,hasFile:false,init:function(a){this.options=jQuery.extend({},this.defaults,a||{});this.detectFeatures();if(!this.hasCanvas){throw new Error("No canvas support, cannot proceed.")}this.createElements()},createElements:function(){this.canvas=document.createElement("canvas");this.pixel=document.createElement("canvas");this.pixel.width=1;this.pixel.height=1},detectFeatures:function(){this.hasCanvas=!!document.createElement("canvas").getContext;this.hasFile=(window.File!==undefined&&window.FileReader!==undefined)},processImage:function(o){var e=this.canvas,g=this.pixel,r=this.options.blockCount,s=this.options.roundingFactor,b=this.options.blocksize,c=Fresh.Color.RGBtoHSV,p,i,t={},q={};e.height=o.height;e.width=o.width;p=e.getContext("2d");i=g.getContext("2d");p.fillStyle="rgb(255,255,255)";p.fillRect(0,0,e.width,e.height);p.drawImage(o,0,0);for(var l=0;l<e.height;l+=b){for(var m=0;m<e.width;m+=b){var j=b,n=b;if(j+m>e.width){j=e.width-m}if(n+l>e.height){n=e.height-l}i.drawImage(e,m,l,j,n,0,0,1,1);var v=i.getImageData(0,0,1,1).data;p.fillStyle="rgb("+w+")";p.fillRect(m,l,b,b);var a={r:v[0],g:v[1],b:v[2]},d=c(a),f=(d.h/s).toFixed(0)*s,u=d.v,h=d.s,w=h+","+u;if((u>80&&h<20)||u<25||h===0){continue}if(t[f]===undefined){t[f]={}}if(t[f][w]===undefined){t[f][w]=0}if(q[f]===undefined){q[f]=0}q[f]+=1;t[f][w]+=1}}return this._calculateScores(q,t)},_calculateScores:function(b,d){var f=[],e,m,g,j,l,c,h=[],a="128,0,50";for(e in b){if(b.hasOwnProperty(e)){f.push({hue:e,count:b[e]})}}if(f.length===0){return[a]}m=function(n,i){var p=n.count,o=i.count;if(p===o){return 0}return p>o?-1:1};f.sort(m);j=this._dominantHues(f);for(k=0;k<j.length;k++){g=j[k];l=d[g];c=[];for(e in l){if(l.hasOwnProperty(e)){c.push({val:e,count:l[e]})}}c.sort(m);h.push(g+","+c[0].val)}return h},_dominantHues:function(e){var c,a,d,b;c=[e[0].hue];for(a=1;a<=e.length;a++){if(c.length>=this.options.numColors){break}d=c[c.length-1];b=Math.abs(d-e[a].hue);if(b>=20){c.push(e[a].hue)}}return c},dominantColors:function(d,c){var b=this.processImage(d),a=Fresh.Color.HSVtoRGB;return jQuery.map(b,function(f,e){var h=f.split(","),g=a({h:h[0],s:h[1],v:h[2]});return c?g.r+","+g.g+","+g.b:g})},readFile:function(b){var d=/^image.*/,a,c,h=this,g;var f=jQuery.Deferred();var e=f.promise();if(!this.hasFile){f.reject("No file");return e}if(!b.type.match(d)){f.reject("Not an image");return e}c=new Image();a=new FileReader();a.onload=function(i){c.src=i.target.result};c.onload=function(){f.resolve(h.dominantColors(c))};a.onerror=function(i){f.reject(i)};a.readAsDataURL(b);return e}});(function(){$("#logo-browse-link").bind("click",function(r){r.preventDefault();$("#upload-logo").trigger("click")});var d,q;try{d=new Fresh.ColorCalculator({numColors:1})}catch(i){}var b=function(e){if(!d){return}q=d.readFile(e)};var g=new Fresh.Uploader({url:"/ajax/branding/updateLogo",dataType:"json",form:"#logo-upload-dialog",input:"#upload-logo",colorcalculator:d,start:function(s){var r=this.form.find(".file-input");if(g.hasProgress){g.progress.show()}if(!this.hasProgress){r.append('<div class="prepend-2 loading">Loading</div>')}else{this.progress.append("<h4>Loading your logo</h4>")}g.form.find(".notify_box_small").hide()},change:function(s,r){if(r.files.length&&this.hasFile&&!this._calculating){b(r.files[0]);this._calculating=true}},dragenter:function(){$(this).addClass("active")},dragleave:function(){$(this).removeClass("active")},drop:function(r){$(this).removeClass("active").addClass("dropped");if(r.dataTransfer.files.length){b(r.dataTransfer.files[0]);this._calculating=true}},done:function(u,t){var w=this,s=t.result.company,v=$("#sysLogo");this._calculating=false;if(t.result.error){return this.options.fail.call(this,null,{},t.result.error)}if(s){var r=new Image();r.src=s.path;r.onload=function(){v.attr({src:s.path,height:s.height,width:s.width});w.form.find(".loading").remove().end().find(".good").show();w.progress.empty().hide();if(q){q.done(function(e){m.setColor(e[0])})}}}},always:function(s,r){this.dropZone.removeClass("dropped")},fail:function(t,s,r){if(!r){r=JSON.parse(s.jqXHR.responseText).error}f.call(this,r)}});var f=function(e){if(typeof e=="string"){e=[e]}this.form.find(".bad").show().text(e[0]);this.progress.empty().hide();this.form.find(".loading").remove()};var l='<div class="mini-color-selector"></div>',n=$("#nav-upload-logo");var p=$(".index thead th, .index thead a, .index thead .no-sort, #cal th, #bigCal th, .listTable th, .newTable th, ul.permissions .enabled");var o=$(".report thead a, .report thead .no-sort, .report tbody.header a, .report tbody.header .no-sort");var h=new Fresh.Color("ffffff");var m=new Fresh.ColorChooser({input:"#color-1-picker",preview:[{element:".nav-mainlinks, .nav-morelinks-container, .index thead td, .index.disabled thead td, .report table th, .report table th a, .reports_currency th a",props:["backgroundColor"]},{element:".nav-mainlinks .active a, #subnav.fresh-header ul li a",props:["color"]}],wellTemplate:l,callback:function(r){var e=new Fresh.Color(r.substring(1)),v=e.darken(20).hex(),u=e.lighten(30).hex(),t=e.lighten(80).hex(),s=(e.brightnessDiff(h)<85?"dark-font":"");p.css({background:r});$("#navmain.fresh-header ul").removeClass("dark-font").addClass(s);if(s=="dark-font"){$(".nav-mainlinks li a, .nav-mainlinks .active a, #subnav.fresh-header .active a, #subnav.fresh-header ul li a").add(p).add(o).css({color:"black"})}else{$(".nav-mainlinks li a").not(".nav-mainlinks .active a").add(p).add(o).css({color:"white"})}$(".nav-morelinks li a").css({borderTopColor:u,borderBottomColor:v});$("#subnav.fresh-header ul li span.active a").css({background:t});$("#subnav.fresh-header ul li span a").not("#subnav.fresh-header ul li span.active a").unbind("mouseenter mouseleave").bind({mouseenter:function(){$(this).css({backgroundColor:t})},mouseleave:function(){$(this).css({backgroundColor:"white"})}});$(".nav-mainlinks li, .nav-morelinks li").unbind("mouseenter mouseleave").bind({mouseenter:function(w){$(this).css({backgroundColor:v})},mouseleave:function(w){$(this).css({backgroundColor:"inherit"})}})}});var j=new Fresh.ColorCollection({pickers:[m],url:"/ajax/branding/updateColors"});var c,a=$("#customize-account-dialog .bad");$(document).bind("change.colorchooser",function(u,r,t,s){if(!t){return false}clearTimeout(c);c=setTimeout(function(){a.hide();var e=j.save();e.fail(function(w){var v=JSON.parse(w.responseText);if(v.error){if(typeof v.error=="string"){v.error=[v.error]}var x="";jQuery.each(v.error,function(){x+=this+"<br />"});a.show().html(x)}})},500)});$("#color-customizer").bind("submit",function(r){r.stopPropagation();r.preventDefault()})})();